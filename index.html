<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Uji Kompetensi - Peningkatan Produktivitas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { 
      font-family: 'Inter', sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      margin: 0;
      padding: 0;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .container {
      max-width: 90vw;
      width: 100%;
      height: 90vh;
      background-color: white;
      border-radius: 1.5rem;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }
    .scrollable-content {
      max-height: calc(90vh - 200px);
      overflow-y: auto;
      padding: 1rem;
    }
    .timer-warning {
      animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
    .option-btn {
      transition: all 0.2s ease;
    }
    .option-btn:hover {
      transform: translateY(-2px);
    }
    .progress-bar {
      height: 4px;
      background-color: #e2e8f0;
      border-radius: 2px;
      margin: 1rem 0;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background-color: #4c51bf;
      transition: width 0.3s ease;
    }
    @media (min-width: 768px) {
      .container {
        max-width: 600px;
        height: 80vh;
      }
      .scrollable-content {
        max-height: calc(80vh - 200px);
      }
    }
    /* Custom scrollbar */
    .scrollable-content::-webkit-scrollbar {
      width: 6px;
    }
    .scrollable-content::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    .scrollable-content::-webkit-scrollbar-thumb {
      background: #c5c5c5;
      border-radius: 10px;
    }
    .scrollable-content::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }
    .question-type {
      display: inline-block;
      background-color: #4c51bf;
      color: white;
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      margin-bottom: 0.5rem;
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 bg-gray-100">
  <div class="container">
    <!-- Header -->
    <div class="p-4 bg-white border-b border-gray-200">
      <div class="flex justify-between items-center mb-2">
        <h1 class="text-lg font-bold text-gray-800">Uji Kompetensi</h1>
        <div id="timer" class="text-red-600 font-bold text-lg">60:00</div>
      </div>
      <div class="progress-bar">
        <div id="progress" class="progress-fill" style="width: 0%"></div>
      </div>
      <div class="flex justify-between text-xs text-gray-500">
        <span>Soal <span id="current-num">1</span> dari <span id="total-num">35</span></span>
        <span id="status">Persiapan</span>
      </div>
    </div>

    <!-- Content -->
    <div id="app" class="flex-1 p-4 overflow-hidden">
      <div id="welcome-screen" class="flex flex-col items-center justify-center h-full text-center space-y-6">
        <h2 class="text-2xl sm:text-3xl font-bold text-gray-800">Peningkatan Produktivitas</h2>
        <p class="text-gray-600 leading-relaxed">Selamat datang di uji kompetensi. Uji ini terdiri dari 30 soal pilihan ganda dan 5 soal esai. Total 35 soal.</p>
        <p class="text-sm text-gray-500">Waktu pengerjaan: 60 menit</p>
        <button onclick="startTest()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
          Mulai Uji
        </button>
      </div>
    </div>
  </div>

  <script>
    const app = document.getElementById('app');
    const timerDisplay = document.getElementById('timer');
    const progressFill = document.getElementById('progress');
    const currentNumDisplay = document.getElementById('current-num');
    const totalNumDisplay = document.getElementById('total-num');
    const statusDisplay = document.getElementById('status');

    // Data soal yang telah disesuaikan dengan materi
    const questions = [
      // 1. Mengumpulkan data dan informasi rencana pelaksanaan peningkatan produktivitas
      { type: "multiple-choice", question: "Manakah yang BUKAN sumber data primer yang direkomendasikan untuk perencanaan peningkatan produktivitas?", options: ["Wawancara dengan manajemen senior", "Observasi langsung proses kerja", "Laporan industri yang sudah berumur 5 tahun", "Survey karyawan secara anonym"], answer: "Laporan industri yang sudah berumur 5 tahun" },
      { type: "multiple-choice", question: "Teknik pengumpulan data mana yang paling efektif untuk memahami proses kerja yang sebenarnya?", options: ["Studi literatur", "Wawancara terstruktur", "Observasi langsung", "Kuesioner tertutup"], answer: "Observasi langsung" },
      { type: "multiple-choice", question: "Apa keuntungan utama menggunakan data kuantitatif dalam perencanaan peningkatan produktivitas?", options: ["Memberikan konteks yang kaya", "Mudah diinterpretasikan oleh semua orang", "Dapat diukur dan dianalisis secara statistik", "Lebih murah untuk dikumpulkan"], answer: "Dapat diukur dan dianalisis secara statistik" },
      
      // 2. Menyusun rencana pelaksanaan peningkatan produktivitas
      { type: "multiple-choice", question: "Apa kelemahan utama dari rencana peningkatan produktivitas yang terlalu ambisius tanpa mempertimbangkan kapasitas organisasi?", options: ["Meningkatkan motivasi karyawan dengan target menantang", "Menghasilkan burnout dan penurunan kualitas kerja", "Mempercepat pencapaian tujuan organisasi", "Mengoptimalkan penggunaan sumber daya yang ada"], answer: "Menghasilkan burnout dan penurunan kualitas kerja" },
      { type: "multiple-choice", question: "Komponen mana yang HARUS dimasukkan dalam rencana pelaksanaan peningkatan produktivitas?", options: ["Analisis pesaing lengkap", "Rencana komunikasi dan keterlibatan stakeholder", "Proyeksi keuangan 5 tahun", "Struktur gaji seluruh karyawan"], answer: "Rencana komunikasi dan keterlibatan stakeholder" },
      { type: "multiple-choice", question: "Mengapa penting untuk menyertakan rencana mitigasi risiko dalam perencanaan produktivitas?", options: ["Agar terlihat profesional di mata direksi", "Untuk mengantisipasi dan mengatasi hambatan potensial", "Karena merupakan persyaratan standar ISO", "Untuk menghabiskan anggaran yang dialokasikan"], answer: "Untuk mengantisipasi dan mengatasi hambatan potensial" },
      
      // 3. Mengevaluasi sistem perencanaan peningkatan produktivitas
      { type: "multiple-choice", question: "Indikator apa yang PALING relevan untuk mengevaluasi keberhasilan sistem perencanaan produktivitas?", options: ["Jumlah halaman dokumen perencanaan", "Kesesuaian antara target yang direncanakan dengan hasil aktual", "Banyaknya meeting yang diadakan", "Kepuasan subjektif manajer proyek"], answer: "Kesesuaian antara target yang direncanakan dengan hasil aktual" },
      { type: "multiple-choice", question: "Kapan sebaiknya evaluasi terhadap sistem perencanaan produktivitas dilakukan?", options: ["Hanya pada akhir proyek", "Secara berkala selama implementasi", "Hanya ketika terjadi masalah serius", "Setiap lima tahun sekali"], answer: "Secara berkala selama implementasi" },
      { type: "multiple-choice", question: "Apa tujuan utama dari evaluasi formatif dalam sistem perencanaan produktivitas?", options: ["Memberikan nilai akhir terhadap kinerja", "Memperbaiki proses yang sedang berjalan", "Memenuhi persyaratan audit", "Membandingkan dengan organisasi lain"], answer: "Memperbaiki proses yang sedang berjalan" },
      
      // 4. Menetapkan target dan sasaran organisasi peningkatan produktivitas
      { type: "multiple-choice", question: "Mengapa target produktivitas sebaiknya ditetapkan dengan menggunakan pendekatan partisipatif?", options: ["Agar target dapat ditetapkan lebih rendah dari kemampuan sebenarnya", "Untuk meningkatkan komitmen dan kepemilikan karyawan terhadap target", "Karena manajemen tidak memahami operasional harian", "Agar target dapat diubah sewaktu-waktu tanpa prosedur formal"], answer: "Untuk meningkatkan komitmen dan kepemilikan karyawan terhadap target" },
      { type: "multiple-choice", question: "Prinsip SMART dalam penentuan target produktivitas mencakup semua berikut, KECUALI:", options: ["Spesifik", "Terukur", "Abstrak", "Relevan"], answer: "Abstrak" },
      { type: "multiple-choice", question: "Apa dampak negatif dari menetapkan target produktivitas yang tidak realistis?", options: ["Meningkatkan kreativitas karyawan", "Menurunkan moral dan motivasi kerja", "Memperbaiki kualitas output", "Mengurangi beban kerja manajemen"], answer: "Menurunkan moral dan motivasi kerja" },
      
      // 5. Menyiapkan organisasi peningkatan produktivitas
      { type: "multiple-choice", question: "Apa risiko terbesar jika tim peningkatan produktivitas hanya terdiri dari manajer level atas saja?", options: ["Keputusan menjadi lebih cepat karena sedikitnya anggota", "Kurangnya pemahaman tentang masalah operasional di lapangan", "Anggaran yang lebih besar tersedia untuk program", "Komunikasi yang lebih efisien dengan direksi"], answer: "Kurangnya pemahaman tentang masalah operasional di lapangan" },
      { type: "multiple-choice", question: "Mengapa penting untuk melibatkan perwakilan dari berbagai level dalam tim produktivitas?", options: ["Agar jumlah anggota tim lebih banyak", "Untuk mendapatkan perspektif yang beragam dan komprehensif", "Karena merupakan persyaratan regulasi", "Agar meeting lebih hidup dengan banyak peserta"], answer: "Untuk mendapatkan perspektif yang beragam dan komprehensif" },
      { type: "multiple-choice", question: "Apa fungsi utama dari champion atau agen perubahan dalam organisasi produktivitas?", options: ["Mengawasi kinerja karyawan", "Mendorong adopsi dan penerapan inisiatif", "Menyusun laporan keuangan", "Mengelola konflik interpersonal"], answer: "Mendorong adopsi dan penerapan inisiatif" },
      
      // 6. Menetapkan indikator keberhasilan peningkatan produktivitas
      { type: "multiple-choice", question: "Manakah yang merupakan contoh indikator leading (mendahului) bukan lagging (mengikuti) untuk mengukur produktivitas?", options: ["Jumlah output per jam kerja", "Tingkat kepuasan pelanggan", "Frekuensi pelatihan keterampilan baru yang diikuti karyawan", "Total penjualan triwulan terakhir"], answer: "Frekuensi pelatihan keterampilan baru yang diikuti karyawan" },
      { type: "multiple-choice", question: "Mengapa penting untuk memiliki kombinasi indikator kuantitatif dan kualitatif?", options: ["Agar laporan terlihat lebih profesional", "Untuk memberikan gambaran yang lebih lengkap dan seimbang", "Karena manajemen meminta kedua jenis indikator", "Agar dapat membandingkan dengan perusahaan lain"], answer: "Untuk memberikan gambaran yang lebih lengkap dan seimbang" },
      { type: "multiple-choice", question: "Apa kelemahan utama dari indikator produktivitas yang hanya berfokus pada output tanpa mempertimbangkan input?", options: ["Mendorong inefisiensi dalam penggunaan sumber daya", "Terlalu sederhana untuk diimplementasikan", "Mudah dimanipulasi oleh karyawan", "Tidak dapat diukur secara objektif"], answer: "Mendorong inefisiensi dalam penggunaan sumber daya" },
      
      // 7. Merencanakan bimbingan penerapan alat, teknik dan metode peningkatan produktivitas
      { type: "multiple-choice", question: "Apa pertimbangan utama ketika memilih teknik peningkatan produktivitas untuk diimplementasikan?", options: ["Popularitas teknik di perusahaan lain", "Kesesuaian dengan budaya dan kebutuhan organisasi", "Ketersediaan konsultan eksternal yang ahli", "Kemudahan dalam pengimplementasiannya"], answer: "Kesesuaian dengan budaya dan kebutuhan organisasi" },
      { type: "multiple-choice", question: "Faktor apa yang paling menentukan keberhasilan program bimbingan penerapan teknik produktivitas?", options: ["Kualitas materi presentasi dan modul pelatihan", "Keterlibatan dan komitmen manajemen puncak", "Ketersediaan anggaran untuk konsultan eksternal", "Kemewahan venue pelatihan yang digunakan"], answer: "Keterlibatan dan komitmen manajemen puncak" },
      { type: "multiple-choice", question: "Apa langkah pertama dalam merencanakan bimbingan penerapan teknik produktivitas?", options: ["Menentukan anggaran", "Melakukan analisis kebutuhan pelatihan", "Memilih vendor pelatihan", "Menjadwalkan sesi pelatihan"], answer: "Melakukan analisis kebutuhan pelatihan" },
      
      // 8. Melaksanakan bimbingan penerapan alat, teknik dan metode peningkatan produktivitas
      { type: "multiple-choice", question: "Mengapa penting untuk menyelenggarakan pilot project sebelum menerapkan teknik produktivitas secara keseluruhan?", options: ["Untuk menghabiskan anggaran pelatihan yang tersedia", "Mengidentifikasi potensi masalah dan menyesuaikan pendekatan", "Memperpanjang durasi proyek peningkatan produktivitas", "Memberi kesan bahwa organisasi serius dengan perubahan"], answer: "Mengidentifikasi potensi masalah dan menyesuaikan pendekatan" },
      { type: "multiple-choice", question: "Mengapa metode pembelajaran orang dewasa (andragogi) penting dalam bimbingan teknik produktivitas?", options: ["Karena peserta training adalah orang dewasa yang sudah memiliki pengalaman", "Agar training terlihat lebih profesional dan berbasis teori", "Karena lebih murah dibanding metode pedagogi", "Untuk memenuhi persyaratan kurikulum yang ditetapkan"], answer: "Karena peserta training adalah orang dewasa yang sudah memiliki pengalaman" },
      { type: "multiple-choice", question: "Apa keuntungan utama menggunakan pendekatan experiential learning dalam bimbingan teknik produktivitas?", options: ["Mengurangi waktu yang dibutuhkan untuk pelatihan", "Memungkinkan peserta menerapkan langsung konsep yang dipelajari", "Lebih mudah untuk dievaluasi hasilnya", "Tidak memerlukan fasilitator yang berpengalaman"], answer: "Memungkinkan peserta menerapkan langsung konsep yang dipelajari" },
      
      // 9. Mengendalikan bimbingan penerapan alat, teknik dan metode peningkatan produktivitas
      { type: "multiple-choice", question: "Apa fungsi utama dari dashboard monitoring dalam pelaksanaan program peningkatan produktivitas?", options: ["Membuat visualisasi yang menarik untuk presentasi direksi", "Memantau kemajuan dan mendeteksi penyimpangan secara real-time", "Menggantikan kebutuhan meeting evaluasi rutin", "Memenuhi persyaratan dokumentasi ISO"], answer: "Memantau kemajuan dan mendeteksi penyimpangan secara real-time" },
      { type: "multiple-choice", question: "Apa tindakan korektif yang paling tepat ketika implementasi teknik produktivitas tidak menunjukkan hasil yang diharapkan?", options: ["Menyalahkan peserta training karena tidak menerapkan dengan benar", "Mengevaluasi dan menyesuaikan pendekatan implementasi", "Menghentikan program dan mencari teknik lainnya", "Melanjutkan program dengan harapan hasil akan membaik dengan sendirinya"], answer: "Mengevaluasi dan menyesuaikan pendekatan implementasi" },
      { type: "multiple-choice", question: "Mengapa penting untuk melakukan evaluasi pasca-implementasi?", options: ["Untuk menghukum mereka yang tidak kooperatif", "Mengidentifikasi pelajaran yang dapat diterapkan di masa depan", "Memenuhi persyaratan audit internal", "Mengisi waktu antara proyek yang sedang berjalan"], answer: "Mengidentifikasi pelajaran yang dapat diterapkan di masa depan" },
      
      // 10. Merencanakan bimbingan penerapan alat, teknik dan metode peningkatan produktivitas
      { type: "multiple-choice", question: "Apa yang membedakan perencanaan bimbingan untuk teknik produktivitas yang berbeda?", options: ["Semua teknik membutuhkan pendekatan yang sama", "Tingkat kompleksitas dan dampaknya terhadap organisasi", "Jumlah peserta yang akan mengikuti bimbingan", "Warna modul pelatihan yang digunakan"], answer: "Tingkat kompleksitas dan dampaknya terhadap organisasi" },
      { type: "multiple-choice", question: "Mengapa penting untuk menyelaraskan rencana bimbingan dengan tujuan strategis organisasi?", options: ["Agar mendapatkan persetujuan anggaran lebih mudah", "Untuk memastikan dukungan berkelanjutan dari manajemen puncak", "Karena merupakan persyaratan dari badan sertifikasi", "Agar pelatihan dapat dijadwalkan pada waktu yang tepat"], answer: "Untuk memastikan dukungan berkelanjutan dari manajemen puncak" },
      
      // 11. Melaksanakan bimbingan penerapan alat, teknik dan metode peningkatan produktivitas
      { type: "multiple-choice", question: "Apa tantangan terbesar dalam melaksanakan bimbingan teknik produktivitas?", options: ["Mengatur jadwal yang sesuai untuk semua peserta", "Mengatasi resistensi terhadap perubahan", "Menyediakan konsumsi yang memadai", "Memilih ruang training yang nyaman"], answer: "Mengatasi resistensi terhadap perubahan" },
      { type: "multiple-choice", question: "Bagaimana sebaiknya menangani peserta yang skeptis selama sesi bimbingan?", options: ["Mengabaikan mereka agar tidak mengganggu yang lain", "Menghadapi skeptisisme secara langsung dengan contoh nyata", "Meminta mereka keluar dari sesi training", "Menjanjikan insentif jika mereka berpartisipasi"], answer: "Menghadapi skeptisisme secara langsung dengan contoh nyata" },
      
      // 12. Mengendalikan bimbingan penerapan alat, teknik dan metode peningkatan produktivitas
      { type: "multiple-choice", question: "Apa indikator utama bahwa bimbingan teknik produktivitas berjalan efektif?", options: ["Seluruh peserta hadir tepat waktu", "Peserta dapat menerapkan teknik yang dipelajari dalam pekerjaan", "Modul training telah didistribusikan kepada semua peserta", "Sesi training selesai sesuai jadwal yang direncanakan"], answer: "Peserta dapat menerapkan teknik yang dipelajari dalam pekerjaan" },
      { type: "multiple-choice", question: "Mengapa penting untuk melakukan penilaian sebelum dan sesudah bimbingan?", options: ["Untuk menguji intelligence peserta", "Mengukur peningkatan pengetahuan dan keterampilan", "Memenuhi persyaratan administrasi HR", "Membandingkan peserta yang satu dengan yang lain"], answer: "Mengukur peningkatan pengetahuan dan keterampilan" },

      // Soal esai (5 soal)
      { type: "essay", question: "Jelaskan langkah-langkah sistematis dalam mengumpulkan data dan informasi untuk perencanaan peningkatan produktivitas di suatu organisasi. Sertakan contoh metode pengumpulan data yang efektif." },
      { type: "essay", question: "Bagaimana Anda menyusun rencana pelaksanaan peningkatan produktivitas yang mempertimbangkan keterbatasan sumber daya dan resistensi terhadap perubahan? Berikan contoh strategi yang dapat digunakan." },
      { type: "essay", question: "Jelaskan metode evaluasi yang komprehensif untuk menilai efektivitas sistem perencanaan peningkatan produktivitas. Sertakan indikator yang dapat digunakan untuk mengukur keberhasilan." },
      { type: "essay", question: "Bagaimana cara menetapkan target dan sasaran peningkatan produktivitas yang ambisius namun tetap realistis dan dapat dicapai? Jelaskan prinsip-prinsip yang perlu diperhatikan." },
      { type: "essay", question: "Jelaskan strategi menyiapkan organisasi untuk program peningkatan produktivitas, termasuk pembentukan tim dan alokasi sumber daya. Apa tantangan yang mungkin dihadapi dan bagaimana mengatasinya?" }
    ];

    let currentQuestionIndex = 0;
    let userAnswers = [];
    let shuffledQuestions = [];
    let timer;
    let timeLeft = 60 * 60; // 60 menit dalam detik
    let isTestStarted = false;

    function showWelcomeScreen() {
      app.innerHTML = `
        <div class="flex flex-col items-center justify-center h-full text-center space-y-6">
          <h2 class="text-2xl sm:text-3xl font-bold text-gray-800">Peningkatan Produktivitas</h2>
          <p class="text-gray-600 leading-relaxed">Selamat datang di uji kompetensi. Uji ini terdiri dari 30 soal pilihan ganda dan 5 soal esai. Total 35 soal.</p>
          <p class="text-sm text-gray-500">Waktu pengerjaan: 60 menit</p>
          <button onclick="startTest()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
            Mulai Uji
          </button>
        </div>`;
      statusDisplay.textContent = "Persiapan";
      timerDisplay.classList.remove('timer-warning');
    }

    function startTest() {
      const mcqQuestions = questions.filter(q => q.type === 'multiple-choice');
      const essayQuestions = questions.filter(q => q.type === 'essay');
      
      // Acak soal PG
      for (let i = mcqQuestions.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [mcqQuestions[i], mcqQuestions[j]] = [mcqQuestions[j], mcqQuestions[i]];
      }
      
      // Acak soal esai
      for (let i = essayQuestions.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [essayQuestions[i], essayQuestions[j]] = [essayQuestions[j], essayQuestions[i]];
      }
      
      shuffledQuestions = [...mcqQuestions, ...essayQuestions];
      currentQuestionIndex = 0;
      userAnswers = Array(shuffledQuestions.length).fill(null);
      isTestStarted = true;
      timeLeft = 60 * 60; // Reset waktu
      
      // Mulai timer
      startTimer();
      
      renderQuestion();
      updateProgress();
    }

    function startTimer() {
      clearInterval(timer); // Hapus timer sebelumnya jika ada
      
      timer = setInterval(() => {
        timeLeft--;
        
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        
        timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        // Warna merah saat waktu kurang dari 10 menit
        if (timeLeft <= 600 && timeLeft > 0) {
          timerDisplay.classList.add('timer-warning');
        }
        
        // Akhiri tes otomatis saat waktu habis
        if (timeLeft <= 0) {
          clearInterval(timer);
          showResults();
        }
      }, 1000);
    }

    function renderQuestion() {
      if (currentQuestionIndex >= shuffledQuestions.length) {
        showResults();
        return;
      }

      const q = shuffledQuestions[currentQuestionIndex];
      let optionsHtml = '';
      let answerValue = '';

      if (userAnswers[currentQuestionIndex]) {
        answerValue = userAnswers[currentQuestionIndex].answer;
      }

      if (q.type === 'multiple-choice') {
        optionsHtml = q.options.map(opt => `
          <div class="mb-3">
            <label class="flex items-start p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 transition duration-200 ${answerValue === opt ? 'bg-blue-100 border-blue-500' : ''}">
              <input type="radio" name="option" value="${opt}" ${answerValue === opt ? 'checked' : ''} onchange="handleOptionChange(this)" class="mt-1 mr-3">
              <span class="text-gray-700">${opt}</span>
            </label>
          </div>
        `).join('');
      } else {
        optionsHtml = `
          <div class="mb-4">
            <textarea id="essay-answer" rows="5" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-y" placeholder="Tulis jawaban Anda di sini...">${answerValue || ''}</textarea>
          </div>`;
      }

      app.innerHTML = `
        <div class="h-full flex flex-col">
          <div class="mb-4">
            <span class="question-type">${q.type === 'multiple-choice' ? 'Pilihan Ganda' : 'Esai'}</span>
            <h3 class="text-lg sm:text-xl font-semibold mb-4 text-gray-800 leading-relaxed">${q.question}</h3>
          </div>
          
          <div class="scrollable-content flex-1 pb-4">
            ${optionsHtml}
          </div>
          
          <div class="flex gap-3 pt-4 border-t border-gray-200">
            <button onclick="goToPreviousQuestion()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 ${currentQuestionIndex === 0 ? 'opacity-50 cursor-not-allowed' : ''}" ${currentQuestionIndex === 0 ? 'disabled' : ''}>
              Sebelumnya
            </button>
            
            <button onclick="nextQuestion()" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
              ${currentQuestionIndex === shuffledQuestions.length - 1 ? 'Selesai' : 'Selanjutnya'}
            </button>
          </div>
        </div>`;
      
      currentNumDisplay.textContent = currentQuestionIndex + 1;
      totalNumDisplay.textContent = shuffledQuestions.length;
      statusDisplay.textContent = `Mengerjakan Soal`;
    }

    function handleOptionChange(radio) {
      const selectedOption = radio.value;
      const currentQuestion = shuffledQuestions[currentQuestionIndex];
      
      // Simpan jawaban
      userAnswers[currentQuestionIndex] = {
        type: 'multiple-choice',
        question: currentQuestion.question,
        answer: selectedOption
      };
    }

    function goToPreviousQuestion() {
      // Simpan jawaban esai terlebih dahulu
      if (shuffledQuestions[currentQuestionIndex].type === 'essay') {
        const textarea = document.getElementById('essay-answer');
        if (textarea) {
          userAnswers[currentQuestionIndex] = {
            type: 'essay',
            question: shuffledQuestions[currentQuestionIndex].question,
            answer: textarea.value
          };
        }
      }
      
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        renderQuestion();
        updateProgress();
      }
    }

    function nextQuestion() {
      const q = shuffledQuestions[currentQuestionIndex];
      let userAnswer = '';
      
      if (q.type === 'multiple-choice') {
        const selected = document.querySelector('input[name="option"]:checked');
        if (!selected) {
          showAlert('Silakan pilih jawaban!');
          return;
        }
        userAnswer = selected.value;
      } else {
        const textarea = document.getElementById('essay-answer');
        userAnswer = textarea.value.trim();
        // Tidak memaksa jawaban esai harus diisi
      }
      
      // Simpan jawaban
      userAnswers[currentQuestionIndex] = {
        type: q.type,
        question: q.question,
        answer: userAnswer
      };
      
      // Lanjut ke soal berikutnya
      currentQuestionIndex++;
      
      if (currentQuestionIndex < shuffledQuestions.length) {
        renderQuestion();
      } else {
        showResults();
      }
      
      updateProgress();
    }

    function updateProgress() {
      const progress = ((currentQuestionIndex + 1) / shuffledQuestions.length) * 100;
      progressFill.style.width = `${progress}%`;
    }

    function showResults() {
      clearInterval(timer);
      
      // Hitung skor pilihan ganda
      let multipleChoiceScore = 0;
      const totalMultipleChoice = shuffledQuestions.filter(q => q.type === 'multiple-choice').length;
      
      for (let i = 0; i < shuffledQuestions.length; i++) {
        const question = shuffledQuestions[i];
        if (question.type === 'multiple-choice' && userAnswers[i] && userAnswers[i].answer === question.answer) {
          multipleChoiceScore++;
        }
      }
      
      const wrongAnswers = totalMultipleChoice - multipleChoiceScore;
      const unanswered = userAnswers.filter(answer => answer === null).length;
      const essayAnswers = userAnswers.filter((a, i) => a && shuffledQuestions[i].type === 'essay');
      
      let essaySummaryHtml = '';
      if (essayAnswers.length > 0) {
        essaySummaryHtml = `<div class="w-full mt-6">
          <h3 class="text-xl font-bold mb-4 text-gray-800 text-left">Ringkasan Jawaban Esai</h3>
          <div class="scrollable-content space-y-4 pr-2">
            ${essayAnswers.map((item, index) => `
              <div class="p-4 rounded-lg bg-gray-100 border border-gray-300 text-left">
                <p class="font-semibold text-gray-800 mb-2">Soal Esai ${index + 1}: ${item.question}</p>
                <p class="text-sm font-medium">Jawaban Anda:</p>
                <p class="text-sm text-gray-700">${item.answer || '(Tidak dijawab)'}</p>
              </div>
            `).join('')}
          </div>
        </div>`;
      }
      
      // Hitung nilai akhir (asumsi esai nilainya perfect jika dijawab)
      const essayScore = essayAnswers.filter(a => a.answer && a.answer.trim() !== '').length;
      const totalScore = multipleChoiceScore + essayScore;
      const maxScore = totalMultipleChoice + essayAnswers.length;
      const percentage = Math.round((totalScore / maxScore) * 100);
      
      app.innerHTML = `
        <div class="flex flex-col h-full">
          <h1 class="text-2xl sm:text-3xl font-bold mb-2 text-blue-600 text-center">Hasil Uji Kompetensi</h1>
          <div class="bg-blue-50 p-4 rounded-lg mb-4 text-center">
            <p class="text-2xl font-bold">Nilai: ${percentage}%</p>
            <p class="text-lg">Skor: ${totalScore}/${maxScore}</p>
          </div>
          
          <p class="text-lg text-gray-700 text-center mb-6">Skor Pilihan Ganda: ${multipleChoiceScore}/${totalMultipleChoice}</p>
          
          <div class="grid grid-cols-3 gap-3 mb-6">
            <div class="text-center p-3 bg-green-100 rounded-lg">
              <div class="text-2xl font-bold text-green-600">${multipleChoiceScore}</div>
              <div class="text-sm text-green-700">Benar</div>
            </div>
            <div class="text-center p-3 bg-red-100 rounded-lg">
              <div class="text-2xl font-bold text-red-600">${wrongAnswers}</div>
              <div class="text-sm text-red-700">Salah</div>
            </div>
            <div class="text-center p-3 bg-yellow-100 rounded-lg">
              <div class="text-2xl font-bold text-yellow-600">${unanswered}</div>
              <div class="text-sm text-yellow-700">Belum Dijawab</div>
            </div>
          </div>
          
          ${essaySummaryHtml}
          
          <div class="mt-auto pt-4">
            <button onclick="showWelcomeScreen()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition duration-200">
              Kembali ke Menu Utama
            </button>
          </div>
        </div>`;
      
      statusDisplay.textContent = "Selesai";
      timerDisplay.classList.remove('timer-warning');
    }

    function showAlert(message) {
      const alertDiv = document.createElement('div');
      alertDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
      alertDiv.innerHTML = `
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full text-center">
          <p class="text-lg font-semibold text-gray-800 mb-4">${message}</p>
          <button onclick="this.parentNode.parentNode.remove()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition duration-200">
            OK
          </button>
        </div>`;
      document.body.appendChild(alertDiv);
    }

    // Handle beforeunload untuk konfirmasi keluar
    window.addEventListener('beforeunload', function(e) {
      if (isTestStarted && timeLeft > 0) {
        const confirmationMessage = 'Anda yakin ingin meninggalkan halaman ini? Proses ujian akan terhenti.';
        e.returnValue = confirmationMessage;
        return confirmationMessage;
      }
    });

    // Inisialisasi
    showWelcomeScreen();
  </script>
</body>
</html>
